import{u as x,j as n,C as f,V as g,H as p,B as C,a as c,F as k,T as v,b as y}from"./index-BhI8Pxlq.js";import{u as S}from"./useQuery-BOvoIR13.js";import{u as j}from"./useMutation-DexDYsTq.js";import{C as o}from"./schemas-DP-A5xcI.js";import{a as u}from"./api-Qa43F_vh.js";const T=e=>{const s=o.fromValue(e.preferredMethod),t=s===o.email?e.email:s===o.sms||s===o.call?e.phone:void 0;return{id:e.id,userId:e.userId,name:`${e.firstName} ${e.lastName}`,preferredChannel:s,handle:t||void 0,intervalDays:e.intervalDays}},F=(e,s)=>s?e===o.email?`mailto:${encodeURIComponent(s)}`:e===o.call?`tel:${s}`:e===o.sms?`sms:${s}`:"#":"#",I=async(e=3)=>{const s=await u("/api/plan"),t=s.items.slice(0,e),l=await Promise.all(t.map(d=>u(`/api/contacts/${encodeURIComponent(d.id)}/suggestions`).then(r=>r[0]??"Hi â€” just checking in!").catch(()=>"Hi â€” just checking in!"))),h=t.map((d,r)=>{const a=T(d);return{...a,link:F(a.preferredChannel,a.handle||""),suggestion:l[r]}});return{date:s.date,picks:h}},z=async e=>u("/api/touches",{method:"POST",body:{contactId:e,method:"OTHER"}}),R=async(e,s)=>{const t=new Date(Date.now()+s*864e5).toISOString();return u(`/api/contacts/${encodeURIComponent(e)}`,{method:"PATCH",body:{snoozedUntil:t}})},q=({count:e=3})=>{var a;const s=x(),{data:t,isLoading:l,error:h}=S({queryKey:["today",e],queryFn:()=>I(e)}),d=j({mutationFn:i=>z(i),onSuccess:()=>s.invalidateQueries({queryKey:["today"]})}),r=j({mutationFn:({contactId:i,days:m})=>R(i,m),onSuccess:()=>s.invalidateQueries({queryKey:["today"]})});return n.jsx(f,{children:n.jsxs(g,{gap:3,children:[n.jsxs(p,{children:[n.jsx("h1",{children:"Todayâ€™s Reach-outs"}),(t==null?void 0:t.date)&&n.jsx(C,{children:t.date})]}),l&&n.jsx(c,{children:"Loadingâ€¦"}),h&&n.jsx(c,{children:"Something went wrong."}),((t==null?void 0:t.picks)??[]).map(i=>n.jsx(c,{children:n.jsxs(g,{gap:2,children:[n.jsxs(p,{children:[n.jsxs("div",{children:[n.jsx("div",{style:{fontWeight:700,fontSize:"1.05rem"},children:i.name}),n.jsxs("div",{style:{color:"#a8b3c7",fontSize:".9rem"},children:[i.preferredChannel.display,": ",i.handle," Â· every"," ",i.intervalDays,"d"]})]}),n.jsxs("a",{href:i.link,children:["Open ",i.preferredChannel.display]})]}),n.jsx(k,{label:"Suggested line",children:n.jsx(v,{defaultValue:i.suggestion,onFocus:m=>m.currentTarget.select()})}),n.jsxs(p,{children:[n.jsx(y,{onClick:()=>d.mutate(i.id),children:"Mark Done"}),n.jsx(y,{variant:"secondary",onClick:()=>r.mutate({contactId:i.id,days:7}),children:"Snooze 7d"}),n.jsx(y,{variant:"ghost",onClick:()=>r.mutate({contactId:i.id,days:1}),children:"Snooze 1d"})]})]})},i.id)),(((a=t==null?void 0:t.picks)==null?void 0:a.length)??0)===0&&!l&&n.jsx(c,{children:"youâ€™re all caught up ðŸŽ‰"})]})})};export{q as Today};
