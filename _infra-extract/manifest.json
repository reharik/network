{
  "copied": [
    { "from": "scripts/deploy-ec2.sh", "to": "scripts/deploy/deploy-ec2.sh", "reason": "Shared EC2 deploy entrypoint; parameterize APP_NAME and /opt paths later" },
    { "from": "scripts/ssm-run.sh", "to": "scripts/deploy/ssm-run.sh", "reason": "Reusable SSM runner for S3-staged remote scripts" },
    { "from": "scripts/remote/download-backend.sh", "to": "scripts/remote/download-backend.sh", "reason": "Backend artifact download from S3; uses APP_NAME env" },
    { "from": "scripts/remote/deploy-backend.sh", "to": "scripts/remote/deploy-backend.sh", "reason": "Runs deploy-ec2.sh on EC2" },
    { "from": "scripts/remote/verify-backend.sh", "to": "scripts/remote/verify-backend.sh", "reason": "Health check for API on EC2" },
    { "from": "scripts/remote/deploy-frontend.sh", "to": "scripts/remote/deploy-frontend.sh", "reason": "Frontend tarball + Caddyfile deploy from S3" },
    { "from": "scripts/remote/setup-shared-proxy.sh", "to": "scripts/remote/setup-shared-proxy.sh", "reason": "Shared Caddy proxy setup; hardcodes /opt/network, /opt/chore-tracker — parameterize later" },
    { "from": "scripts/remote/deploy-shared-caddyfile.sh", "to": "scripts/remote/deploy-shared-caddyfile.sh", "reason": "Deploy shared Caddyfile from S3" },
    { "from": "scripts/remote/cleanup-docker.sh", "to": "scripts/remote/cleanup-docker.sh", "reason": "Generic Docker prune on EC2" },
    { "from": "scripts/verify-dns-and-frontend.sh", "to": "scripts/local/verify-dns-and-frontend.sh", "reason": "Local DNS/frontend check; domains (backintouch.net) are app-specific — parameterize or use as template" },
    { "from": ".github/workflows/ci.yml", "to": "github/workflows/ci.yml", "reason": "CI template (lint, test, build); app uses npm scripts and Nx" },
    { "from": ".github/workflows/deploy-ec2.yml", "to": "github/workflows/deploy-ec2.yml", "reason": "Deploy template; APP_NAME, S3_BUCKET, path filters are app-specific" },
    { "from": "tsconfig.json (compilerOptions only)", "to": "config/tsconfig/tsconfig.base.json", "reason": "Shared TypeScript compiler options; app adds references and paths" },
    { "from": "eslint-shared.js", "to": "config/eslint/eslint-shared.js", "reason": "Shared ESLint base (TypeScript + Prettier + Jest); app projects extend it" },
    { "from": ".prettierrc.json", "to": "config/prettier/.prettierrc.json", "reason": "Shared Prettier config" },
    { "from": ".prettierignore", "to": "config/prettier/.prettierignore", "reason": "Shared Prettier ignore" },
    { "from": "nx.json", "to": "config/nx/nx.json", "reason": "Nx base (extends npm preset); project graph and $schema path are app-owned" },
    { "from": "Caddyfile.shared (as example)", "to": "templates/app/Caddyfile.shared.example", "reason": "Template for multi-app shared Caddy; app provides actual Caddyfile.shared" },
    { "from": "jest.preset.cjs", "to": "config/jest/jest.preset.cjs", "reason": "Shared Nx/Jest preset; app projects extend it via preset path" },
    { "from": "apps/api/Dockerfile (as template)", "to": "templates/app/Dockerfile.example", "reason": "Generic multi-stage Node/Nx API Dockerfile pattern; app copies and customizes" },
    { "from": ".dockerignore (as template)", "to": "templates/app/.dockerignore.example", "reason": "Pattern for monorepo API build; app copies and adjusts paths" },
    { "from": "docker-compose.yml (as template)", "to": "templates/app/docker-compose.example.yml", "reason": "Minimal postgres + api compose pattern; app copies and sets APP_NAME, image, paths" }
  ],
  "left_in_app": [
    { "path": "Caddyfile", "reason": "App-specific single-app Caddy config (backintouch.net, api service)" },
    { "path": "docker-compose.prod.yml", "reason": "App-specific compose (services, env paths, image names)" },
    { "path": "docker-compose.yml, docker-compose-dev.yml, docker-compose-local-prod.yml", "reason": "App-specific compose files (service names, images, localstack, volumes)" },
    { "path": "apps/api/Dockerfile", "reason": "App-specific Dockerfile (apps/api, packages/contracts, gen:container, awilix, serverStartUpProd)" },
    { "path": ".dockerignore", "reason": "App-specific (lists apps/api, packages/contracts, excludes apps/web)" },
    { "path": "apps/*/jest.config.js, packages/*/jest.config.js", "reason": "Per-project Jest config (displayName, setupFiles, mocks); they extend shared preset" },
    { "path": "apps/", "reason": "Application and API code" },
    { "path": "packages/", "reason": "App-specific packages (e.g. contracts)" },
    { "path": ".env*, env/", "reason": "Secrets and env files" },
    { "path": ".github/workflows/README.md", "reason": "App-specific workflow docs and secret names" },
    { "path": "docs/deployment-ec2.md, EC2_DEPLOYMENT_*.md", "reason": "App-specific deployment docs; generic flow in infra docs/deploy.md" }
  ],
  "todo": [
    "Parameterize deploy scripts by APP_NAME and app root path (e.g. /opt/{app})",
    "Parameterize setup-shared-proxy.sh: app list and host dirs (not hardcode /opt/network, /opt/chore-tracker)",
    "Namespace S3 keys by app (already uses APP_NAME; ensure all scripts use it consistently)",
    "Convert deploy-ec2.yml to reusable workflow (workflow_call) with inputs: app_name, s3_bucket, backend_paths, frontend_paths, dockerfile_path, etc.",
    "When app uses subtree: wire workflow to infra paths (e.g. source infra/scripts/deploy/ssm-run.sh, upload from infra/scripts/remote/)",
    "Parameterize verify-dns-and-frontend.sh with domain list or skip; or keep as app-owned script",
    "Consider app-owned infra.app.config.json (APP_NAME, S3_BUCKET, SSM tags, path filters) consumed by workflows/scripts"
  ],
  "risks": [
    "Jest preset path: when consumed from infra, app jest.config.js must reference correct preset path (e.g. infra/config/jest/jest.preset.cjs)",
    "Nx config: nx.json extends npm preset and has no app paths, but $schema and project graph are resolved in app repo; copying into infra/config/nx is for reference — app may extend or copy",
    "Path assumptions: deploy-ec2.sh and remote scripts assume /opt/network, apps/api; multi-app repos need parameterized app root and service names",
    "ESLint shared: eslint-shared.js uses import.meta.dirname for tsconfigRootDir; when consumed from infra/ the root dir may need to be app repo root",
    "Workflows reference scripts/deploy-ec2.sh and scripts/remote/* — in subtree layout scripts live under infra/scripts/deploy/ and infra/scripts/remote/; app workflow must reference correct paths or copy workflows to .github/workflows and adjust paths",
    "Version coupling: Node 22, npm, Nx 21, action versions are fixed in workflows; infra and app should align on versions"
  ]
}
